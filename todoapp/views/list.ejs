<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
          integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">

    <title>To-do List</title>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Todo App</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
            <li class="nav-item active">
                <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Write</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Temporary</a>
            </li>
        </ul>
    </div>
</nav>
<!--
ì„œë²„ì—ì„œ ì‰½ê²Œ í• ì¼ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì˜¤ê³  ì‹¶ìœ¼ë©´ EJS ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì“°ì!
*EJS: EJS ëŠ” ì„œë²„ ë°ì´í„°ë¥¼ HTML ì— ì‰½ê²Œì‰½ê²Œ ë°•ì•„ë„£ì„ ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ”
      ì¼ì¢…ì˜ HTML ë Œë”ë§ ì—”ì§„ í˜¹ì€ template engine(ì „ì²˜ë¦¬ ì—”ì§„)ì´ë¼ê³  ë¶€ë¥¸ë‹¤!
      ì´ê²ƒ ë§ê³  PUG ë„ ìˆì§€ë§Œ EJS ê°€ ì“°ê¸°ì— ë” ì‰½ë‹¤ê³ í•¨!
      EJS simply stands for Embedded Javascript.
      It is a simple templating language/engine that lets its user generate HTML with plain javascript.
      EJS is mostly useful whenever you have to output HTML with a lot of javascript.
      *** EJS íŒŒì¼ì€ HTML ê³¼ ë˜‘ê°™ì€ë° HTML íƒœê·¸ ì•ˆì— ë‚´ìš©ë¬¼ë¡œ ì„œë²„ë¡œ ë³´ëƒˆë˜ ë°ì´í„°ë¥¼ ì§‘ì–´ë„£ì„ ìˆ˜ ìˆë‹¤! ***
        Ex) <h4>To-do: < %= ë³€ìˆ˜ì´ë¦„ % ></h4>   -> ì´ë ‡ê²Œ í•˜ë©´ HTML ê¸€ìë¡œ ë Œë”ë§ë¨
      ë§Œì•½ Vue, React, Angular ë¥¼ ì•ˆë‹¤ë©´, html ì„ íš¨ê³¼ì ìœ¼ë¡œ ë°ì´í„° ë°”ì¸ë”© ê°€ëŠ¥!
-->
<h4 class="ml-2 my-3">To-do List from Server</h4>
    <ul class="list-group">
        <% for(let i = 0; i < posts.length; i++) { %>
            <li class="list-group-item">
                <p>No. <%= posts[i]._id %></p>
                <h4>To-do List: <%= posts[i].todo %></h4>
                <p>Due Date: <%= posts[i].date %></p>
                <button class="delete" data-id="<%= posts[i]._id %>">Delete</button>
            </li>
        <% } %>
    </ul>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script>
    // ğŸŸ« 1.ajax ë¡œ delete ê¸°ëŠ¥ êµ¬í˜„í•˜ëŠ” ë°©ë²•! (ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ê·¸ì— í•´ë‹¹í•˜ëŠ” {_id: numOfPost} ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    $('.delete').click(function (e) {
        let numOfPost = e.target.dataset.id;
        let ì§€ê¸ˆëˆ„ë¥¸ê±° = $(this);   // *this: í˜„ì¬ í´ë¦­ ì´ë²¤íŠ¸ê°€ ë™ì‘í•˜ëŠ” ê³³!(ìš°ë¦¬ê°€ ë°©ê¸ˆ ëˆ„ë¥¸ delete ë²„íŠ¼ì˜ ëœ»ê³¼ ë§¤ìš° ìœ ì‚¬!)
                                  // *e.target: ì§€ê¸ˆ í´ë¦­í•œê²ƒ
        $.ajax({    // â† ajax ìš”ì²­ì„ í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜
            method: 'DELETE',
            url: '/delete',     // â† ì„œë²„ì— ìƒˆë¡œê³ ì¹¨ì—†ì´ /delete ê²½ë¡œë¡œ DELETE ìš”ì²­ì„ í•´ì£¼ì„¸ìš”
            data: {_id: numOfPost}      // ìš”ì²­ê³¼ í•¨ê»˜ ë³´ë‚¼ ë°ì´í„°(ë‚˜ì¤‘ì— ğŸŸ«2.ì—ì„œ 'server.js' ì—ì„œ 'req.body' ë¡œ ë“¤ì–´ì˜¤ëŠ” ì •ë³´!)
        }).done(function (result) { // ìœ„ì˜ AJAX ìš”ì²­ì´ ì„±ê³µí–ˆì„ë•Œ ì´ ì½”ë“œë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”~
            // â†“ ìœ„ì˜ AJAX ì½”ë“œ ì„±ê³µì‹œ ì•„ë˜ ì½”ë“œ ì‹¤í–‰í•´ì£¼ì„¸ìš”
            //   ('/delete' ë¡œ ì—°ê²°ëœ ì„œë²„ì—ì„œ ì‘ë‹µì„ í•´ì¤˜ì•¼ done ì•ˆì— ìˆëŠ” ì½œë°±í•¨ìˆ˜ê°€ ì‹¤í–‰ë¨!!)
            //   ë°©ë²•1) í˜ì´ì§€ë¥¼ ê°•ì œë¡œ ìƒˆë¡œ ê³ ì¹¨í•´ì£¼ì„¸ìš”    -> location.reload(); [jQuery í•¨ìˆ˜?]
            //         -> ì´ ë°©ë²•ì„ ì“°ë©´ ajax ë¥¼ ì“°ëŠ” ì´ìœ ê°€ ì—†ìŒ! (ajax ëŠ” ìƒˆë¡œê³ ì¹¨ ì—†ì´ ìŠ¤ë¬´ìŠ¤í•˜ê²Œ ê¸€ì„ ë°œí–‰, ì‚­ì œ, ìˆ˜ì •ì‹œì¼œì£¼ê¸° ë•Œë¬¸!)
            //   ë°©ë²•2) ì‚­ì œ ë²„íŠ¼ì„ ëˆ„ë¥¸ <li> ìš”ì†Œë¥¼ ì œê±°í•´ì£¼ì„¸ìš” / ì•ˆë³´ì´ê²Œ
            console.log('ì„±ê³µë '); // â† ë¸Œë¼ìš°ì €ì˜ ì½˜ì†”ì°½
            ì§€ê¸ˆëˆ„ë¥¸ê±°.parent('li').fadeOut(); // ì§€ê¸ˆ ëˆ„ë¥¸ê±°(ë²„íŠ¼)ì˜ ë¶€ëª¨ ìš”ì†Œ ì¤‘ì— li íƒœê·¸ë¥¼ ì°¾ì•„ì„œ fadeOut() ì²˜ë¦¬ë¥¼ í•´ì¤˜!
            // â†‘ .done ì•ˆì˜ ì½”ë“œê°€ ì œëŒ€ë¡œ ë™ì‘í•˜ê¸° ìœ„í•´ì„œ 'server.js' ì—ì„œ /delete ê²½ë¡œë¡œ DELETE ìš”ì²­ì´ ì„±ê³µí–ˆì„ë•Œ, ì¦‰, ì—¬ê¸°ì„  deleteOne í•¨ìˆ˜ê°€ ì„±ê³µí•˜ë©´ ì„±ê³µí–ˆë‹¤ëŠ” ë©”ì„¸ì§€ë¥¼ ì˜ ë³´ë‚´ì¤˜ì•¼í•¨!
            //    Ex) res.status(200).send({message: 'Successful!'});   -> 200: OK(ìš”ì²­ ì„±ê³µ!)  400: Bad Request(ê³ ê° ì˜ëª»ìœ¼ë¡œ ìš”ì²­ì‹¤íŒ¨)
        }).fail(function (xhr, textStatus, errorThrown) {
            // ìš”ì²­ ì‹¤íŒ¨ì‹œ ì‹¤í–‰í•  ì½”ë“œëŠ” ì—¬ê¸°!
            // ì¦‰, server.js ì—ì„œ /delete ê²½ë¡œë¡œ DELETE ìš”ì²­ì´ ì‹¤íŒ¨í–ˆì„ë•Œ ì•„ë˜ ì½”ë“œ ì‹¤í–‰!
            //   Ex) res.status(400).send({message: 'Failed'});  ì—ì„œì™€ ê°™ì´ Response Code ê°€ ì‹¤íŒ¨(400)ì—¬ì•¼ í•œë‹¤!
            console.log(xhr, textStatus, errorThrown);
            // {readyState: 4, getResponseHeader: Æ’, getAllResponseHeaders: Æ’, setRequestHeader: Æ’, overrideMimeType: Æ’,Â â€¦}
            // *textStatus: Response Code(ì‘ë‹µì½”ë“œ)
            // *errorThrown: ì—ëŸ¬ë©”ì„¸ì§€ ë°˜í™˜
        });
    });

    /* jQuery ì˜ ë„ì›€ì„ ë°›ì•„ì„œ AJAX ê°œë°œ! */
    /*      AJAX ë¥¼ ìƒ JSë¡œ ì§œë ¤ê³  í•˜ë©´ ì½”ë“œê°€ ë„ˆë¬´ ê¸¸ì–´ì§! */

</script>
    <!-- ğŸŸ© Delete ìš”ì²­í•˜ëŠ” ë²• -->
        <!-- 1) method-override ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ìš© -->
        <!--    â†‘ node.js í™˜ê²½ì—ì„œ ì„œë²„ë§Œë“¤ ë•Œ ì“¸ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
        <!--      ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì“°ë©´ ë²„íŠ¼ì„ ëˆŒë €ì„ë•Œ delete ìš”ì²­ì´ ê°€ëŠ¥í•´ì§! -->
        <!-- 2) JavaScript AJAX ë¥¼ ì´ìš© -->
        <!--    â†‘ ì„œë²„ë§Œë“¤ë•Œ ê¼­ í•„ìš”í•¨ (ì–¸ì  ê°€ëŠ” ì“°ê²Œ ë˜ìˆìŒ) -->
        <!--      ê°„ë‹¨í•œ ì„œë²„ë“  ë³µì¡í•œ ì„œë²„ë“  ê¼­ ë‹¤ë¤„ì•¼í•  ë‚´ìš©! -->
        <!-- 3) ê·¸ëƒ¥ POST ìš”ì²­ì„ ë‚ ë ¤ì„œ DELETE ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤ -->
    <!-- ğŸŸ© AJAX ë€? -->
        <!-- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ JS ë¥¼ ì´ìš©í•´ ì„œë²„ì— ì—¬ëŸ¬ê°€ì§€ ìš”ì²­ì„ í•  ìˆ˜ ìˆëŠ” ë¬¸ë²• ê°™ì€ ê²ƒì…ë‹ˆë‹¤. -->
        <!-- ì„œë²„ë‘ í†µì‹ í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” JS ë¬¸ë²•! -->
        <!-- ì¦‰, JS ê°€ ì„œë²„ë‘ ìš”ì²­ì„ ì£¼ê³  ë°›ì„ ë•Œ ì“°ëŠ” ë¬¸ë²•!-->
        <!--    Ex) GET, POST ìš”ì²­ -->
        <!-- *ì¥ì : ìƒˆë¡œê³ ì¹¨ ì—†ì´ë„ ì„œë²„ì™€ í†µì‹  ê°€ëŠ¥! -->



<!-- Optional JavaScript; choose one of the two! -->

<!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
        crossorigin="anonymous"></script>

<!-- Option 2: Separate Popper and Bootstrap JS -->
<!--
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+" crossorigin="anonymous"></script>
-->
</body>
</html>